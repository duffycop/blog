<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/atom.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2019-01-14T15:40:05-03:00</updated><id>http://localhost:4000/atom.xml</id><title type="html">TinoUY</title><subtitle>Un sitio sobre informatica y electronica.</subtitle><entry><title type="html">Instalando DRBD</title><link href="http://localhost:4000/2018/01/Instalando-DRBD" rel="alternate" type="text/html" title="Instalando DRBD" /><published>2018-01-19T00:00:00-03:00</published><updated>2018-01-19T00:00:00-03:00</updated><id>http://localhost:4000/2018/01/Instalando-DRBD</id><content type="html" xml:base="http://localhost:4000/2018/01/Instalando-DRBD">&lt;p&gt;Bienvenidos aventureros.
En este post vamos a aprender a instalar DRBD. &lt;!-- more --&gt;.
En cada nodo tendremos un disco vacio y completamente dedicado a DRBD, por lo tanto usaremos este disco /dev/vda&lt;/p&gt;

&lt;h3 id=&quot;que-es-drbd-distributed-replicated-block-device&quot;&gt;Que es DRBD (Distributed Replicated Block Device)?&lt;/h3&gt;

&lt;p&gt;DRBD es un software que permite hacer replica de los datos de una particion o disco entre varias maquinas a traves de la red.&lt;/p&gt;

&lt;h3 id=&quot;entorno&quot;&gt;Entorno&lt;/h3&gt;
&lt;hr /&gt;

&lt;blockquote&gt;
  &lt;table&gt;
    &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td&gt;Nodo1&lt;/td&gt;
        &lt;td&gt;drbd1&lt;/td&gt;
        &lt;td&gt;192.168.10.10&lt;/td&gt;
        &lt;td&gt;CentOS 7&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;

  &lt;table&gt;
    &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td&gt;Nodo2&lt;/td&gt;
        &lt;td&gt;drbd2&lt;/td&gt;
        &lt;td&gt;192.168.10.11&lt;/td&gt;
        &lt;td&gt;CentOS 7&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;instalando&quot;&gt;Instalando&lt;/h3&gt;
&lt;p&gt;Para comenzar con la instalación lo primero que haremos sera ir a una terminal de linux.
1 - Ejecutaremos los siguientes comandos para agregar el repositorio ELRepo en ambos nodos:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2 - Luego ejecutamos lo siguiente para instalar DRBD y los modulos del kernel necesarios para el funcionamiento de DRBD:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yum install drbd90-utils kmod-drbd90
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cuando finalice la instalación comprobaremos si el modulo del kernel fue cargado:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lsmod | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; drbd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si no fue cargado automáticamente entonces ejecutamos:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;modprobe drbd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Nota&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;El comando modprobe cargara el modulo durante la sesión activa, para que el modulo se cargue en el inicio hay que utilizar el servicio &lt;strong&gt;systemd-modules-load&lt;/strong&gt; creando un archivo dentro de &lt;strong&gt;/etc/modulesload.d/&lt;/strong&gt; y de esta manera el modulo es cargado durante cada inicio del sistema.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;drbd &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /etc/modules-load.d/drbd.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configurando-drbd&quot;&gt;Configurando DRBD&lt;/h3&gt;
&lt;p&gt;Luego de instalar DRBD de forma correcta lo que haremos sera cambiar la configuración global editando el archivo &lt;strong&gt;/etc/drbd.d/global_common.conf&lt;/strong&gt;
1 - Vamos a hacer un backup del archivo original:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mv /etc/drbd.d/global_common.conf /etc/drbd.d/global_common.conf.orig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2 - Creamos un nuevo archivo de configuración global:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vi /etc/drbd.d/global_common.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;global {
 usage-count no;
}
common {
 net {
  protocol C;
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3 - Lo siguiente sera crear un archivo de configuración para el recurso &lt;strong&gt;drbd0&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vi /etc/drbd.d/drbd0.res
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource drbd0 {
	disk /dev/vda;
	device /dev/drbd0;
	meta-disk internal;
	on drbd1 {
		address 192.168.10.10:7789;
	}
	on drbd2 {
		address 192.168.10.11:7789;
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Nota&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;En el archivo de recurso de arriba hemos creado un nuevo recurso llamado drbd0, donde 192.168.10.10 y 192.168.10.11 son las IP de nuestros nodos y 7789 el puerto utilizado para la comunicación, usando el disco /dev/vda para crear el dispositivo /dev/drbd0.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;4 - Inicializar el dispositivo drbd0 en cada nodo:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;drbdadm create-md drbd0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5 - Iniciar y habilitar el demonio drbd en ambos nodos:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;systemctl start drbd
systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;drbd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;6 - Definamos el Nodo1 como nodo primario:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;drbdadm up drbd0
drbdadm primary drbd0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Nota&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;En caso de tener algún error para definir el nodo como primaro ejecutamos el mismo comando pero con el parámetro –force para forzar esta opcion.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;drbdadm primary drbd &lt;span class=&quot;nt&quot;&gt;--force&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;7 - Para chequear el estado de la sincronización mientras se ejecuta utilizamos el siguiente comando:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;drbdadm status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;8 - Ajustes de firewall en ambos nodos:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--add-rich-rule&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'rule family=&quot;ipv4&quot; source address=&quot;ip_nodo&quot; port port=&quot;7789&quot; protocol=&quot;tcp&quot; accept'&lt;/span&gt;
firewall-cmd &lt;span class=&quot;nt&quot;&gt;--reload&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;testeando-drbd&quot;&gt;Testeando DRBD&lt;/h3&gt;

&lt;p&gt;Para testear DRBD crearemos un filesystem, montaremos el volumen y crearemos archivos en el nodo primario &lt;em&gt;drbd1&lt;/em&gt;, finalmente cambiaremos el nodo primario a &lt;em&gt;drbd2&lt;/em&gt; y comprobaremos que DRBD funciona.
Con el siguiente comando crearemos un filesystem xfs en /dev/drbd0 y lo montaremos en /mnt/&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkfs.xfs /dev/drbd0
mount /dev/drbd0 /mnt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Crearemos archivos con&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;touch /mnt/file&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;1..5&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; /mnt/
total 0
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file1
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file2
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file3
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file4
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora cambiaremos el nodo primario de &lt;em&gt;drbd1&lt;/em&gt; a &lt;em&gt;drbd2&lt;/em&gt;
Primero desmontamos el volumen drbd0&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;umount /mnt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cambiamos el Nodo1 de primario a secundario&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;drbdadm secondary drbd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora cambiamos el Nodo2 de secundario a primario&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;drbdadm primary drbd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Montamos el filesystem y comprobamos que tenga los archivos dentro&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mount /dev/drbd0 /mnt
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;  /mnt
total 0
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file1
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file2
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file3
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file4
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 1 root root 0 Sep 22 21:43 file5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Tino</name></author><category term="DRBD" /><category term="Tutoriales" /><summary type="html">Bienvenidos aventureros. En este post vamos a aprender a instalar DRBD. . En cada nodo tendremos un disco vacio y completamente dedicado a DRBD, por lo tanto usaremos este disco /dev/vda</summary></entry><entry><title type="html">Hola Mundo!</title><link href="http://localhost:4000/2018/01/primer-post" rel="alternate" type="text/html" title="Hola Mundo!" /><published>2018-01-03T13:23:10-03:00</published><updated>2018-01-03T13:23:10-03:00</updated><id>http://localhost:4000/2018/01/primer-post</id><content type="html" xml:base="http://localhost:4000/2018/01/primer-post">&lt;p&gt;Hola mundo! Este es mi blog con Jekyll, ahora no hay más excusas para no tener un blog o documentación!&lt;/p&gt;</content><author><name>Tino</name></author><category term="Getting" /><category term="started" /><summary type="html">Hola mundo! Este es mi blog con Jekyll, ahora no hay más excusas para no tener un blog o documentación!</summary></entry></feed>