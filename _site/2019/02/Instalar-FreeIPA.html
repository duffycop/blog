<!DOCTYPE html>
<html class="t-grey">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Instalando FreeIPA</title>
  <meta name="description" content="Bienvenido internauta.Hoy vamos a aprender a instalar un CentOS 7 con FreeIPA para administración de identidades. .Vamos a tener configurado 1 solo equipo do...">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,700|Roboto+Mono:400,500' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/2019/02/Instalar-FreeIPA">
  <link rel="alternate" type="application/rss+xml" title="TinoUY" href="http://localhost:4000/feed.xml">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-7765886811341988",
            enable_page_level_ads: true
       });
  </script>


</head>

  <body>
    
<style>

.topnav {
  overflow: hidden;
}

.topnav a {
  float: left;
  display: block;
}

.topnav .icon {
  display: none;
}

.topnav a:hover, .dropdown:hover .dropbtn {
  color: white;
}

.dropdown-content a:hover {
  color: black;
}

.dropdown:hover .dropdown-content {
  display: block;
}

@media screen and (max-width: 600px) {
  .topnav a:not(:first-child), .dropdown .dropbtn {
    display: none;
  }
  .topnav a.icon {
    float: right;
    display: block;
  }
}

@media screen and (max-width: 600px) {
  .topnav.responsive {position: relative;}
  .topnav.responsive .icon {
    position: absolute;
  }
  .topnav.responsive a {
    float: none;
    display: block;
  }
  .topnav.responsive .dropdown {float: none;}
  .topnav.responsive .dropdown-content {position: relative;}
  .topnav.responsive .dropdown .dropbtn {
    display: block;
    width: 100%;
  }
}
</style>

<nav class="c-navigation is-fixed">
  <div class="c-navigation__container u-container topnav" id="myTopnav">
    <a class="c-navigation__item " href="/">Inicio</a>
    <a class="c-navigation__item " href="/articulos/">Articulos</a>
    <a class="c-navigation__item " href="/contacto/">Contacto</a>
    <a class="c-navigation__item " href="/about/">About</a>
    <a class="c-navigation__item search" href="/search/"><i class="material-icons">search</i></a>
    <a href="javascript:void(0);myFunction();" style="font-size:15px;" class="c-navigation__item icon" role="button" onclick="myFunction()"><i class="material-icons">menu</i></a>
  </div>
</nav>

<script>
function myFunction() {
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
}
</script>


    <article class="c-article">
  <header class="c-header c-article__header">
    <div class="u-container">
      <h1 class="c-header__title">Instalando FreeIPA</h1>
    </div>
  </header>

  <div class="c-article__main">
    <p>Bienvenido internauta.
Hoy vamos a aprender a instalar un CentOS 7 con FreeIPA para administración de identidades. <!-- more -->.
Vamos a tener configurado 1 solo equipo donde tendremos el FreeIPA.</p>

<h3 id="que-es-freeipa-distributed-replicated-block-device">Que es FreeIPA (Distributed Replicated Block Device)?</h3>

<table>
  <tbody>
    <tr>
      <td>Es un proyecto de suite de software de código fuente libre mantenida por el Proyecto Fedora, patrocinada por RedHat, el nombre significa Identidad</td>
      <td>Políticas</td>
      <td>Auditoría Libre (en inglés, Free Identity</td>
      <td>Policy</td>
      <td>Audit), tiene por objetivo proveer un interfaz segura y sencilla para la administración de identidades comparable a Novell Identity Manager, IBM Security Directory Suite, Redhat 389 Directory Server, Apache Directory Studio y Microsoft Active Directory</td>
    </tr>
  </tbody>
</table>

<!-- ### Entorno
-------------

> Nodo1 | drbd1 | 192.168.10.10 | CentOS 7
>
> Nodo2 | drbd2 | 192.168.10.11 | CentOS 7

### Instalando
Para comenzar con la instalación lo primero que haremos sera ir a una terminal de linux.
1 - Ejecutaremos los siguientes comandos para agregar el repositorio ELRepo en ambos nodos:
```
# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
```

2 - Luego ejecutamos lo siguiente para instalar DRBD y los modulos del kernel necesarios para el funcionamiento de DRBD:
```bash
yum install drbd90-utils kmod-drbd90
```

Cuando finalice la instalación comprobaremos si el modulo del kernel fue cargado:
```bash
lsmod | grep -i drbd
```

Si no fue cargado automáticamente entonces ejecutamos:
```bash
modprobe drbd
```

***Nota***
> El comando modprobe cargara el modulo durante la sesión activa, para que el modulo se cargue en el inicio hay que utilizar el servicio **systemd-modules-load** creando un archivo dentro de **/etc/modulesload.d/** y de esta manera el modulo es cargado durante cada inicio del sistema.

```bash
echo drbd > /etc/modules-load.d/drbd.conf
```

### Configurando DRBD
Luego de instalar DRBD de forma correcta lo que haremos sera cambiar la configuración global editando el archivo **/etc/drbd.d/global_common.conf**
1 - Vamos a hacer un backup del archivo original:
```bash
mv /etc/drbd.d/global_common.conf /etc/drbd.d/global_common.conf.orig
```

2 - Creamos un nuevo archivo de configuración global:
```bash
vi /etc/drbd.d/global_common.conf
```
```
global {
 usage-count no;
}
common {
 net {
  protocol C;
 }
}
```

3 - Lo siguiente sera crear un archivo de configuración para el recurso **drbd0**:
```bash
vi /etc/drbd.d/drbd0.res
```
```
resource drbd0 {
	disk /dev/vda;
	device /dev/drbd0;
	meta-disk internal;
	on drbd1 {
		address 192.168.10.10:7789;
	}
	on drbd2 {
		address 192.168.10.11:7789;
	}
}
```

***Nota***
>  En el archivo de recurso de arriba hemos creado un nuevo recurso llamado drbd0, donde 192.168.10.10 y 192.168.10.11 son las IP de nuestros nodos y 7789 el puerto utilizado para la comunicación, usando el disco /dev/vda para crear el dispositivo /dev/drbd0.

4 - Inicializar el dispositivo drbd0 en cada nodo:

```bash
drbdadm create-md drbd0
```

5 - Iniciar y habilitar el demonio drbd en ambos nodos:
```bash
systemctl start drbd
systemctl enable drbd
```

6 - Definamos el Nodo1 como nodo primario:
```bash
drbdadm up drbd0
drbdadm primary drbd0
```
***Nota***
>  En caso de tener algún error para definir el nodo como primaro ejecutamos el mismo comando pero con el parámetro --force para forzar esta opcion.

```bash
drbdadm primary drbd --force
```

7 - Para chequear el estado de la sincronización mientras se ejecuta utilizamos el siguiente comando:
```bash
drbdadm status
```

8 - Ajustes de firewall en ambos nodos:
```bash
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="ip_nodo" port port="7789" protocol="tcp" accept'
firewall-cmd --reload
```

### Testeando DRBD

Para testear DRBD crearemos un filesystem, montaremos el volumen y crearemos archivos en el nodo primario _drbd1_, finalmente cambiaremos el nodo primario a _drbd2_ y comprobaremos que DRBD funciona.
Con el siguiente comando crearemos un filesystem xfs en /dev/drbd0 y lo montaremos en /mnt/
```bash
mkfs.xfs /dev/drbd0
mount /dev/drbd0 /mnt
```

Crearemos archivos con
```bash
touch /mnt/file{1..5}
ls -l /mnt/
total 0
-rw-r--r--. 1 root root 0 Sep 22 21:43 file1
-rw-r--r--. 1 root root 0 Sep 22 21:43 file2
-rw-r--r--. 1 root root 0 Sep 22 21:43 file3
-rw-r--r--. 1 root root 0 Sep 22 21:43 file4
-rw-r--r--. 1 root root 0 Sep 22 21:43 file5
```

Ahora cambiaremos el nodo primario de _drbd1_ a _drbd2_
Primero desmontamos el volumen drbd0
```bash
umount /mnt
```

Cambiamos el Nodo1 de primario a secundario
```bash
drbdadm secondary drbd
```

Ahora cambiamos el Nodo2 de secundario a primario
```bash
drbdadm primary drbd
```

Montamos el filesystem y comprobamos que tenga los archivos dentro
```bash
mount /dev/drbd0 /mnt
ls -l  /mnt
total 0
-rw-r--r--. 1 root root 0 Sep 22 21:43 file1
-rw-r--r--. 1 root root 0 Sep 22 21:43 file2
-rw-r--r--. 1 root root 0 Sep 22 21:43 file3
-rw-r--r--. 1 root root 0 Sep 22 21:43 file4
-rw-r--r--. 1 root root 0 Sep 22 21:43 file5
```
-->



<div class="container">
  <div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">
      <div id="disqus_thread"></div>
        <script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
          (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://tinouy.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</div>



  </div>
</article>


    <footer class="c-footer">
  <div class="u-container c-footer__container">
    <p>&copy; TinoUY 2019</p>
    <p>
      
      
      
      
    </p>
  </div>
</footer>

  </body>
</html>
